CVE Number : CVE-2014-8481
Commit Message : 
KVM: emulate: avoid accessing NULL ctxt->memopp
Commit Details : 
A failure to decode the instruction can cause a NULL pointer access.
This is fixed simply by moving the "done" label as close as possible
to the return.

This fixes CVE-2014-8481.

Reported-by: Andy Lutomirski <luto@amacapital.net>
Cc: stable@vger.kernel.org
Fixes: 41061cdb98a0bec464278b4db8e894a3121671f5
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Before patch : 
 	/* Decode and fetch the destination operand: register or memory. */
 	rc = decode_operand(ctxt, &ctxt >dst, (ctxt >d >> DstShift) & OpMask);
 
 done:
 	if (ctxt >rip_relative)
 		ctxt >memopp >addr.mem.ea  = ctxt >_eip;
 
 	return (rc != X86EMUL_CONTINUE) ? EMULATION_FAILED : EMULATION_OK;
 }
 
After patch : 
 	/* Decode and fetch the destination operand: register or memory. */
 	rc = decode_operand(ctxt, &ctxt >dst, (ctxt >d >> DstShift) & OpMask);
 
 	if (ctxt >rip_relative)
 		ctxt >memopp >addr.mem.ea  = ctxt >_eip;
 
 done:
 	return (rc != X86EMUL_CONTINUE) ? EMULATION_FAILED : EMULATION_OK;
 }
 
