CVE Number : CVE-2017-8067
Commit Message : 
virtio-console: avoid DMA from stack
Commit Details : 
put_chars() stuffs the buffer it gets into an sg, but that buffer may be
on the stack. This breaks with CONFIG_VMAP_STACK=y (for me, it
manifested as printks getting turned into NUL bytes).

Signed-off-by: Omar Sandoval <osandov@fb.com>
Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Reviewed-by: Amit Shah <amit.shah@redhat.com>

Before patch : 
 {
 	struct port *port;
 	struct scatterlist sg[1];
 
 	if (unlikely(early_put_chars))
 		return early_put_chars(vtermno, buf, count);
 	if (!port)
 		return  EPIPE;
 
 	sg_init_one(sg, buf, count);
 	return __send_to_port(port, sg, 1, count, (void *)buf, false);
 }
 
 /*
After patch : 
 {
 	struct port *port;
 	struct scatterlist sg[1];
 	void *data;
 	int ret;
 
 	if (unlikely(early_put_chars))
 		return early_put_chars(vtermno, buf, count);
 	if (!port)
 		return  EPIPE;
 
 	data = kmemdup(buf, count, GFP_ATOMIC);
 	if (!data)
 		return  ENOMEM;
 
 	sg_init_one(sg, data, count);
 	ret = __send_to_port(port, sg, 1, count, data, false);
 	kfree(data);
 	return ret;
 }
 
 /*
