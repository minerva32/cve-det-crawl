CVE Number : CVE-2010-1641
Commit Message : 
GFS2: Fix permissions checking for setflags ioctl()
Commit Details : 
We should be checking for the ownership of the file for which
flags are being set, rather than just for write access.

Reported-by: Dan Rosenberg <dan.j.rosenberg@gmail.com>
Signed-off-by: Steven Whitehouse <swhiteho@redhat.com>

Before patch : 
 	if (error)
 		goto out_drop_write;
 
 	flags = ip >i_diskflags;
 	new_flags = (flags & ~mask) | (reqflags & mask);
 	if ((new_flags ^ flags) == 0)
 {
 	struct inode *inode = filp >f_path.dentry >d_inode;
 	u32 fsflags, gfsflags;
 	if (get_user(fsflags, ptr))
 		return  EFAULT;
 	gfsflags = fsflags_cvt(fsflags_to_gfs2, fsflags);
 	if (!S_ISDIR(inode >i_mode)) {
 		if (gfsflags & GFS2_DIF_INHERIT_JDATA)
After patch : 
 	if (error)
 		goto out_drop_write;
 
 	error =  EACCES;
 	if (!is_owner_or_cap(inode))
 		goto out;
 
 	error = 0;
 	flags = ip >i_diskflags;
 	new_flags = (flags & ~mask) | (reqflags & mask);
 	if ((new_flags ^ flags) == 0)
 {
 	struct inode *inode = filp >f_path.dentry >d_inode;
 	u32 fsflags, gfsflags;
 
 	if (get_user(fsflags, ptr))
 		return  EFAULT;
 
 	gfsflags = fsflags_cvt(fsflags_to_gfs2, fsflags);
 	if (!S_ISDIR(inode >i_mode)) {
 		if (gfsflags & GFS2_DIF_INHERIT_JDATA)
