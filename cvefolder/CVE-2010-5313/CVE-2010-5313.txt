CVE Number : CVE-2010-5313
Commit Message : 
KVM: X86: Don't report L2 emulation failures to user-space
Commit Details : 
This patch prevents that emulation failures which result
from emulating an instruction for an L2-Guest results in
being reported to userspace.
Without this patch a malicious L2-Guest would be able to
kill the L1 by triggering a race-condition between an vmexit
and the instruction emulator.
With this patch the L2 will most likely only kill itself in
this situation.

Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>
Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>

Before patch : 
 
 static int handle_emulation_failure(struct kvm_vcpu *vcpu)
 {
 	  vcpu >stat.insn_emulation_fail;
 	trace_kvm_emulate_insn_failed(vcpu);
 	vcpu >run >exit_reason = KVM_EXIT_INTERNAL_ERROR;
 	vcpu >run >internal.suberror = KVM_INTERNAL_ERROR_EMULATION;
 	vcpu >run >internal.ndata = 0;
 	kvm_queue_exception(vcpu, UD_VECTOR);
 	return EMULATE_FAIL;
 }
 
 static bool reexecute_instruction(struct kvm_vcpu *vcpu, gva_t gva)
After patch : 
 
 static int handle_emulation_failure(struct kvm_vcpu *vcpu)
 {
 	int r = EMULATE_DONE;
 
 	  vcpu >stat.insn_emulation_fail;
 	trace_kvm_emulate_insn_failed(vcpu);
 	if (!is_guest_mode(vcpu)) {
 		vcpu >run >exit_reason = KVM_EXIT_INTERNAL_ERROR;
 		vcpu >run >internal.suberror = KVM_INTERNAL_ERROR_EMULATION;
 		vcpu >run >internal.ndata = 0;
 		r = EMULATE_FAIL;
 	}
 	kvm_queue_exception(vcpu, UD_VECTOR);
 
 	return r;
 }
 
 static bool reexecute_instruction(struct kvm_vcpu *vcpu, gva_t gva)
