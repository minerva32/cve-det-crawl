CVE Number : CVE-2010-4650
Commit Message : 
fuse: verify ioctl retries
Commit Details : 
Verify that the total length of the iovec returned in FUSE_IOCTL_RETRY
doesn't overflow iov_length().

Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
CC: Tejun Heo <tj@kernel.org>
CC: <stable@kernel.org>         2.6.31+

Before patch : 
 	return 0;
 }
 
 /*
  * For ioctls, there is no generic way to determine how much memory
  * needs to be read and/or written.  Furthermore, ioctls are allowed
 		in_iov = page_address(iov_page);
 		out_iov = in_iov   in_iovs;
 
 		goto retry;
 	}
 
After patch : 
 	return 0;
 }
 
 /* Make sure iov_length() won't overflow */
 static int fuse_verify_ioctl_iov(struct iovec *iov, size_t count)
 {
 	size_t n;
 	u32 max = FUSE_MAX_PAGES_PER_REQ << PAGE_SHIFT;
 
 	for (n = 0; n < count; n  ) {
 		if (iov >iov_len > (size_t) max)
 			return  ENOMEM;
 		max  = iov >iov_len;
 	}
 	return 0;
 }
 
 /*
  * For ioctls, there is no generic way to determine how much memory
  * needs to be read and/or written.  Furthermore, ioctls are allowed
 		in_iov = page_address(iov_page);
 		out_iov = in_iov   in_iovs;
 
 		err = fuse_verify_ioctl_iov(in_iov, in_iovs);
 		if (err)
 			goto out;
 
 		err = fuse_verify_ioctl_iov(out_iov, out_iovs);
 		if (err)
 			goto out;
 
 		goto retry;
 	}
 
