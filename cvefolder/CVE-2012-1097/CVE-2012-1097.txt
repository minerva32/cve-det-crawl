CVE Number : CVE-2012-1097
Commit Message : 
regset: Prevent null pointer reference on readonly regsets
Commit Details : 
The regset common infrastructure assumed that regsets would always
have .get and .set methods, but not necessarily .active methods.
Unfortunately people have since written regsets without .set methods.

Rather than putting in stub functions everywhere, handle regsets with
null .get or .set methods explicitly.

Signed-off-by: H. Peter Anvin <hpa@zytor.com>
Reviewed-by: Oleg Nesterov <oleg@redhat.com>
Acked-by: Roland McGrath <roland@hack.frob.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

Before patch : 
 	for (i = 1; i < view >n;   i) {
 		const struct user_regset *regset = &view >regsets[i];
 		do_thread_regset_writeback(t >task, regset);
 		if (regset >core_note_type &&
 		    (!regset >active || regset >active(t >task, regset))) {
 			int ret;
 			size_t size = regset >n * regset >size;
 {
 	const struct user_regset *regset = &view >regsets[setno];
 
 	if (!access_ok(VERIFY_WRITE, data, size))
 		return  EIO;
 
 {
 	const struct user_regset *regset = &view >regsets[setno];
 
 	if (!access_ok(VERIFY_READ, data, size))
 		return  EIO;
 
After patch : 
 	for (i = 1; i < view >n;   i) {
 		const struct user_regset *regset = &view >regsets[i];
 		do_thread_regset_writeback(t >task, regset);
 		if (regset >core_note_type && regset >get &&
 		    (!regset >active || regset >active(t >task, regset))) {
 			int ret;
 			size_t size = regset >n * regset >size;
 {
 	const struct user_regset *regset = &view >regsets[setno];
 
 	if (!regset >get)
 		return  EOPNOTSUPP;
 
 	if (!access_ok(VERIFY_WRITE, data, size))
 		return  EIO;
 
 {
 	const struct user_regset *regset = &view >regsets[setno];
 
 	if (!regset >set)
 		return  EOPNOTSUPP;
 
 	if (!access_ok(VERIFY_READ, data, size))
 		return  EIO;
 
