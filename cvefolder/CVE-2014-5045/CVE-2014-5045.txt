CVE Number : CVE-2014-5045
Commit Message : 
fs: umount on symlink leaks mnt count
Commit Details : 
Currently umount on symlink blocks following umount:

/vz is separate mount

# ls /vz/ -al | grep test
drwxr-xr-x.  2 root root       4096 Jul 19 01:14 testdir
lrwxrwxrwx.  1 root root         11 Jul 19 01:16 testlink -> /vz/testdir
# umount -l /vz/testlink
umount: /vz/testlink: not mounted (expected)

# lsof /vz
# umount /vz
umount: /vz: device is busy. (unexpected)

In this case mountpoint_last() gets an extra refcount on path->mnt

Signed-off-by: Vasily Averin <vvs@openvz.org>
Acked-by: Ian Kent <raven@themaw.net>
Acked-by: Jeff Layton <jlayton@primarydata.com>
Cc: stable@vger.kernel.org
Signed-off-by: Christoph Hellwig <hch@lst.de>

Before patch : 
 		goto out;
 	}
 	path >dentry = dentry;
 	path >mnt = mntget(nd >path.mnt);
 	if (should_follow_link(dentry, nd >flags & LOOKUP_FOLLOW))
 		return 1;
 	follow_mount(path);
 	error = 0;
 out:
After patch : 
 		goto out;
 	}
 	path >dentry = dentry;
 	path >mnt = nd >path.mnt;
 	if (should_follow_link(dentry, nd >flags & LOOKUP_FOLLOW))
 		return 1;
 	mntget(path >mnt);
 	follow_mount(path);
 	error = 0;
 out:
