CVE Number : CVE-2014-0203
Commit Message : 
fix autofs/afs/etc. magic mountpoint breakage
Commit Details : 
We end up trying to kfree() nd.last.name on open("/mnt/tmp", O_CREAT)
if /mnt/tmp is an autofs direct mount.  The reason is that nd.last_type
is bogus here; we want LAST_BIND for everything of that kind and we
get LAST_NORM left over from finding parent directory.

So make sure that it *is* set properly; set to LAST_BIND before
doing ->follow_link() - for normal symlinks it will be changed
by __vfs_follow_link() and everything else needs it set that way.

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

Before patch : 
 		dget(dentry);
 	}
 	mntget(path >mnt);
 	cookie = dentry >d_inode >i_op >follow_link(dentry, nd);
 	error = PTR_ERR(cookie);
 	if (!IS_ERR(cookie)) {
 		goto out;
 
 	error = PROC_I(inode) >op.proc_get_link(inode, &nd >path);
 	nd >last_type = LAST_BIND;
 out:
 	return ERR_PTR(error);
 }
After patch : 
 		dget(dentry);
 	}
 	mntget(path >mnt);
 	nd >last_type = LAST_BIND;
 	cookie = dentry >d_inode >i_op >follow_link(dentry, nd);
 	error = PTR_ERR(cookie);
 	if (!IS_ERR(cookie)) {
 		goto out;
 
 	error = PROC_I(inode) >op.proc_get_link(inode, &nd >path);
 out:
 	return ERR_PTR(error);
 }
