CVE Number : CVE-2013-2850
Commit Message : 
iscsi-target: fix heap buffer overflow on error
Commit Details : 
If a key was larger than 64 bytes, as checked by iscsi_check_key(), the
error response packet, generated by iscsi_add_notunderstood_response(),
would still attempt to copy the entire key into the packet, overflowing
the structure on the heap.

Remote preauthentication kernel memory corruption was possible if a
target was configured and listening on the network.

CVE-2013-2850

Signed-off-by: Kees Cook <keescook@chromium.org>
Cc: stable@vger.kernel.org
Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

Before patch : 
 	}
 	INIT_LIST_HEAD(&extra_response >er_list);
 
 	strncpy(extra_response >key, key, strlen(key)   1);
 	strncpy(extra_response >value, NOTUNDERSTOOD,
 			strlen(NOTUNDERSTOOD)   1);
 
 	list_add_tail(&extra_response >er_list,
 			&param_list >extra_response_list);
 
 		if (phase & PHASE_SECURITY) {
 			if (iscsi_check_for_auth_key(key) > 0) {
 				char *tmpptr = key   strlen(key);
 				*tmpptr = '=';
 				kfree(tmpbuf);
 				return 1;
 			}
 #ifndef ISCSI_PARAMETERS_H
 #define ISCSI_PARAMETERS_H
 
 struct iscsi_extra_response {
 	char key[64];
 	char value[32];
 	struct list_head er_list;
 } ____cacheline_aligned;
After patch : 
 	}
 	INIT_LIST_HEAD(&extra_response >er_list);
 
 	strlcpy(extra_response >key, key, sizeof(extra_response >key));
 	strlcpy(extra_response >value, NOTUNDERSTOOD,
 		sizeof(extra_response >value));
 
 	list_add_tail(&extra_response >er_list,
 			&param_list >extra_response_list);
 
 		if (phase & PHASE_SECURITY) {
 			if (iscsi_check_for_auth_key(key) > 0) {
 				kfree(tmpbuf);
 				return 1;
 			}
 #ifndef ISCSI_PARAMETERS_H
 #define ISCSI_PARAMETERS_H
 
 #include <scsi/iscsi_proto.h>
 
 struct iscsi_extra_response {
 	char key[KEY_MAXLEN];
 	char value[32];
 	struct list_head er_list;
 } ____cacheline_aligned;
