CVE Number : CVE-2018-10901
Commit Message : 
KVM: VMX: Fix host GDT.LIMIT corruption
Commit Details : 
vmx does not restore GDT.LIMIT to the host value, instead it sets it to 64KB.
This means host userspace can learn a few bits of host memory.

Fix by reloading GDTR when we load other host state.

Signed-off-by: Avi Kivity <avi@redhat.com>
Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>

Before patch : 
 static DEFINE_PER_CPU(struct vmcs *, vmxarea);
 static DEFINE_PER_CPU(struct vmcs *, current_vmcs);
 static DEFINE_PER_CPU(struct list_head, vcpus_on_cpu);
 
 static unsigned long *vmx_io_bitmap_a;
 static unsigned long *vmx_io_bitmap_b;
 #endif
 	if (current_thread_info() >status & TS_USEDFPU)
 		clts();
 }
 
 static void vmx_load_host_state(struct vcpu_vmx *vmx)
 		ept_sync_global();
 	}
 
 	return 0;
 }
 
After patch : 
 static DEFINE_PER_CPU(struct vmcs *, vmxarea);
 static DEFINE_PER_CPU(struct vmcs *, current_vmcs);
 static DEFINE_PER_CPU(struct list_head, vcpus_on_cpu);
 static DEFINE_PER_CPU(struct desc_ptr, host_gdt);
 
 static unsigned long *vmx_io_bitmap_a;
 static unsigned long *vmx_io_bitmap_b;
 #endif
 	if (current_thread_info() >status & TS_USEDFPU)
 		clts();
 	load_gdt(&__get_cpu_var(host_gdt));
 }
 
 static void vmx_load_host_state(struct vcpu_vmx *vmx)
 		ept_sync_global();
 	}
 
 	store_gdt(&__get_cpu_var(host_gdt));
 
 	return 0;
 }
 
