CVE Number : CVE-2011-1593
Commit Message : 
proc: do proper range check on readdir offset
Commit Details : 
Rather than pass in some random truncated offset to the pid-related
functions, check that the offset is in range up-front.

This is just cleanup, the previous commit fixed the real problem.

Cc: stable@kernel.org
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

Before patch : 
 /* for the /proc/ directory itself, after non process stuff has been done */
 int proc_pid_readdir(struct file * filp, void * dirent, filldir_t filldir)
 {
 	unsigned int nr = filp >f_pos   FIRST_PROCESS_ENTRY;
 	struct task_struct *reaper = get_proc_task(filp >f_path.dentry >d_inode);
 	struct tgid_iter iter;
 	struct pid_namespace *ns;
 
 	if (!reaper)
 		goto out_no_task;
 
After patch : 
 /* for the /proc/ directory itself, after non process stuff has been done */
 int proc_pid_readdir(struct file * filp, void * dirent, filldir_t filldir)
 {
 	unsigned int nr;
 	struct task_struct *reaper;
 	struct tgid_iter iter;
 	struct pid_namespace *ns;
 
 	if (filp >f_pos >= PID_MAX_LIMIT   TGID_OFFSET)
 		goto out_no_task;
 	nr = filp >f_pos   FIRST_PROCESS_ENTRY;
 
 	reaper = get_proc_task(filp >f_path.dentry >d_inode);
 	if (!reaper)
 		goto out_no_task;
 
