CVE Number : CVE-2013-7348
Commit Message : 
aio: prevent double free in ioctx_alloc
Commit Details : 
ioctx_alloc() calls aio_setup_ring() to allocate a ring. If aio_setup_ring()
fails to do so it would call aio_free_ring() before returning, but
ioctx_alloc() would call aio_free_ring() again causing a double free of
the ring.

This is easily reproducible from userspace.

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
Signed-off-by: Benjamin LaHaise <bcrl@kvack.org>

Before patch : 
 err_cleanup:
 	aio_nr_sub(ctx >max_reqs);
 err:
 	aio_free_ring(ctx);
 	free_percpu(ctx >cpu);
 	free_percpu(ctx >reqs.pcpu_count);
 	free_percpu(ctx >users.pcpu_count);
After patch : 
 err_cleanup:
 	aio_nr_sub(ctx >max_reqs);
 err:
 	free_percpu(ctx >cpu);
 	free_percpu(ctx >reqs.pcpu_count);
 	free_percpu(ctx >users.pcpu_count);
