CVE Number : CVE-2009-1897
Commit Message : 
tun/tap: Fix crashes if open() /dev/net/tun and then poll() it.
Commit Details : 
Fix NULL pointer dereference in tun_chr_pool() introduced by commit
33dccbb050bbe35b88ca8cf1228dcf3e4d4b3554 ("tun: Limit amount of queued
packets per device") and triggered by this code:

	int fd;
	struct pollfd pfd;
	fd = open("/dev/net/tun", O_RDWR);
	pfd.fd = fd;
	pfd.events = POLLIN | POLLOUT;
	poll(&pfd, 1, 0);

Reported-by: Eugene Kapun <abacabadabacaba@gmail.com>
Signed-off-by: Mariusz Kozlowski <m.kozlowski@tuxland.pl>
Signed-off-by: David S. Miller <davem@davemloft.net>

Before patch : 
 {
 	struct tun_file *tfile = file >private_data;
 	struct tun_struct *tun = __tun_get(tfile);
 	struct sock *sk = tun >sk;
 	unsigned int mask = 0;
 
 	if (!tun)
 		return POLLERR;
 
 	DBG(KERN_INFO "%s: tun_chr_poll\n", tun >dev >name);
 
 	poll_wait(file, &tun >socket.wait, wait);
After patch : 
 {
 	struct tun_file *tfile = file >private_data;
 	struct tun_struct *tun = __tun_get(tfile);
 	struct sock *sk;
 	unsigned int mask = 0;
 
 	if (!tun)
 		return POLLERR;
 
 	sk = tun >sk;
 
 	DBG(KERN_INFO "%s: tun_chr_poll\n", tun >dev >name);
 
 	poll_wait(file, &tun >socket.wait, wait);
