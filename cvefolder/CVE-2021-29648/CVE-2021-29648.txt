CVE Number : CVE-2021-29648
Commit Message : 
bpf: Dont allow vmlinux BTF to be used in map_create and prog_load.
Commit Details : 
The syzbot got FD of vmlinux BTF and passed it into map_create which caused
crash in btf_type_id_size() when it tried to access resolved_ids. The vmlinux
BTF doesn't have 'resolved_ids' and 'resolved_sizes' initialized to save
memory. To avoid such issues disallow using vmlinux BTF in prog_load and
map_create commands.

Fixes: 5329722057d4 ("bpf: Assign ID to vmlinux BTF and return extra info for BTF in GET_OBJ_INFO")
Reported-by: syzbot+8bab8ed346746e7540e8@syzkaller.appspotmail.com
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Acked-by: Yonghong Song <yhs@fb.com>
Link: https://lore.kernel.org/bpf/20210307225248.79031-1-alexei.starovoitov@gmail.com

Before patch : 
 			err = PTR_ERR(btf);
 			goto free_map;
 		}
 		map >btf = btf;
 
 		if (attr >btf_value_type_id) {
 	btf = btf_get_by_fd(attr >prog_btf_fd);
 	if (IS_ERR(btf))
 		return PTR_ERR(btf);
 	env >prog >aux >btf = btf;
 
 	err = check_btf_func(env, attr, uattr);
After patch : 
 			err = PTR_ERR(btf);
 			goto free_map;
 		}
 		if (btf_is_kernel(btf)) {
 			btf_put(btf);
 			err =  EACCES;
 			goto free_map;
 		}
 		map >btf = btf;
 
 		if (attr >btf_value_type_id) {
 	btf = btf_get_by_fd(attr >prog_btf_fd);
 	if (IS_ERR(btf))
 		return PTR_ERR(btf);
 	if (btf_is_kernel(btf)) {
 		btf_put(btf);
 		return  EACCES;
 	}
 	env >prog >aux >btf = btf;
 
 	err = check_btf_func(env, attr, uattr);
