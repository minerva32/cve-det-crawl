CVE Number : CVE-2016-10088
Commit Message : 
sg_write()/bsg_write() is not fit to be called under KERNEL_DS
Commit Details : 
Both damn things interpret userland pointers embedded into the payload;
worse, they are actually traversing those.  Leaving aside the bad
API design, this is very much _not_ safe to call with KERNEL_DS.
Bail out early if that happens.

Cc: stable@vger.kernel.org
Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

Before patch : 
 
 	dprintk("%s: write %Zd bytes\n", bd >name, count);
 
 	bsg_set_block(bd, file);
 
 	bytes_written = 0;
 	sg_io_hdr_t *hp;
 	unsigned char cmnd[SG_MAX_CDB_SIZE];
 
 	if ((!(sfp = (Sg_fd *) filp >private_data)) || (!(sdp = sfp >parentdp)))
 		return  ENXIO;
 	SCSI_LOG_TIMEOUT(3, sg_printk(KERN_INFO, sdp,
After patch : 
 
 	dprintk("%s: write %Zd bytes\n", bd >name, count);
 
 	if (unlikely(segment_eq(get_fs(), KERNEL_DS)))
 		return  EINVAL;
 
 	bsg_set_block(bd, file);
 
 	bytes_written = 0;
 	sg_io_hdr_t *hp;
 	unsigned char cmnd[SG_MAX_CDB_SIZE];
 
 	if (unlikely(segment_eq(get_fs(), KERNEL_DS)))
 		return  EINVAL;
 
 	if ((!(sfp = (Sg_fd *) filp >private_data)) || (!(sdp = sfp >parentdp)))
 		return  ENXIO;
 	SCSI_LOG_TIMEOUT(3, sg_printk(KERN_INFO, sdp,
