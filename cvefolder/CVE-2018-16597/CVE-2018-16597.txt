CVE Number : CVE-2018-16597
Commit Message : 
ovl: modify ovl_permission() to do checks on two inodes
Commit Details : 
Right now ovl_permission() calls __inode_permission(realinode), to do
permission checks on real inode and no checks are done on overlay inode.

Modify it to do checks both on overlay inode as well as underlying inode.
Checks on overlay inode will be done with the creds of calling task while
checks on underlying inode will be done with the creds of mounter.

Signed-off-by: Vivek Goyal <vgoyal@redhat.com>
Signed-off-by: Miklos Szeredi <mszeredi@redhat.com>

Before patch : 
 	bool is_upper;
 	struct dentry *realdentry = ovl_entry_real(oe, &is_upper);
 	struct inode *realinode;
 	int err;
 
 	if (ovl_is_default_permissions(inode)) {
 			return  EROFS;
 	}
 
 	return __inode_permission(realinode, mask);
 }
 
 static const char *ovl_get_link(struct dentry *dentry,
 {
 	struct inode *realinode = ovl_inode_real(inode);
 
 	if (!realinode)
 		return ERR_PTR( ENOENT);
 
 	if (!IS_POSIXACL(realinode))
 		return NULL;
 
After patch : 
 	bool is_upper;
 	struct dentry *realdentry = ovl_entry_real(oe, &is_upper);
 	struct inode *realinode;
 	const struct cred *old_cred;
 	int err;
 
 	if (ovl_is_default_permissions(inode)) {
 			return  EROFS;
 	}
 
 	/*
 	 * Check overlay inode with the creds of task and underlying inode
 	 * with creds of mounter
 	 */
 	err = generic_permission(inode, mask);
 	if (err)
 		return err;
 
 	old_cred = ovl_override_creds(inode >i_sb);
 	err = __inode_permission(realinode, mask);
 	revert_creds(old_cred);
 
 	return err;
 }
 
 static const char *ovl_get_link(struct dentry *dentry,
 {
 	struct inode *realinode = ovl_inode_real(inode);
 
 	if (!IS_POSIXACL(realinode))
 		return NULL;
 
