CVE Number : CVE-2017-18174
Commit Message : 
pinctrl: amd: Use devm_pinctrl_register() for pinctrl registration
Commit Details : 
Use devm_pinctrl_register() for pin control registration and clean
error path.

Signed-off-by: Laxman Dewangan <ldewangan@nvidia.com>
Signed-off-by: Linus Walleij <linus.walleij@linaro.org>

Before patch : 
 	gpio_dev >ngroups = ARRAY_SIZE(kerncz_groups);
 
 	amd_pinctrl_desc.name = dev_name(&pdev >dev);
 	gpio_dev >pctrl = pinctrl_register(&amd_pinctrl_desc,
 					&pdev >dev, gpio_dev);
 	if (IS_ERR(gpio_dev >pctrl)) {
 		dev_err(&pdev >dev, "Couldn't register pinctrl driver\n");
 		return PTR_ERR(gpio_dev >pctrl);
 
 	ret = gpiochip_add_data(&gpio_dev >gc, gpio_dev);
 	if (ret)
 		goto out1;
 
 	ret = gpiochip_add_pin_range(&gpio_dev >gc, dev_name(&pdev >dev),
 				0, 0, TOTAL_NUMBER_OF_PINS);
 out2:
 	gpiochip_remove(&gpio_dev >gc);
 
 out1:
 	pinctrl_unregister(gpio_dev >pctrl);
 	return ret;
 }
 
 	gpio_dev = platform_get_drvdata(pdev);
 
 	gpiochip_remove(&gpio_dev >gc);
 	pinctrl_unregister(gpio_dev >pctrl);
 
 	return 0;
 }
After patch : 
 	gpio_dev >ngroups = ARRAY_SIZE(kerncz_groups);
 
 	amd_pinctrl_desc.name = dev_name(&pdev >dev);
 	gpio_dev >pctrl = devm_pinctrl_register(&pdev >dev, &amd_pinctrl_desc,
 						gpio_dev);
 	if (IS_ERR(gpio_dev >pctrl)) {
 		dev_err(&pdev >dev, "Couldn't register pinctrl driver\n");
 		return PTR_ERR(gpio_dev >pctrl);
 
 	ret = gpiochip_add_data(&gpio_dev >gc, gpio_dev);
 	if (ret)
 		return ret;
 
 	ret = gpiochip_add_pin_range(&gpio_dev >gc, dev_name(&pdev >dev),
 				0, 0, TOTAL_NUMBER_OF_PINS);
 out2:
 	gpiochip_remove(&gpio_dev >gc);
 
 	return ret;
 }
 
 	gpio_dev = platform_get_drvdata(pdev);
 
 	gpiochip_remove(&gpio_dev >gc);
 
 	return 0;
 }
