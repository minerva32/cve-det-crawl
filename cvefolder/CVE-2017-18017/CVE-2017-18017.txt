CVE Number : CVE-2017-18017
Commit Message : 
netfilter: xt_TCPMSS: add more sanity tests on tcph->doff
Commit Details : 
Denys provided an awesome KASAN report pointing to an use
after free in xt_TCPMSS

I have provided three patches to fix this issue, either in xt_TCPMSS or
in xt_tcpudp.c. It seems xt_TCPMSS patch has the smallest possible
impact.

Signed-off-by: Eric Dumazet <edumazet@google.com>
Reported-by: Denys Fedoryshchenko <nuclearcat@nuclearcat.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

Before patch : 
 	tcph = (struct tcphdr *)(skb_network_header(skb)   tcphoff);
 	tcp_hdrlen = tcph >doff * 4;
 
 	if (len < tcp_hdrlen)
 		return  1;
 
 	if (info >mss == XT_TCPMSS_CLAMP_PMTU) {
 	if (len > tcp_hdrlen)
 		return 0;
 
 	/*
 	 * MSS Option not found ?! add it..
 	 */
After patch : 
 	tcph = (struct tcphdr *)(skb_network_header(skb)   tcphoff);
 	tcp_hdrlen = tcph >doff * 4;
 
 	if (len < tcp_hdrlen || tcp_hdrlen < sizeof(struct tcphdr))
 		return  1;
 
 	if (info >mss == XT_TCPMSS_CLAMP_PMTU) {
 	if (len > tcp_hdrlen)
 		return 0;
 
 	/* tcph >doff has 4 bits, do not wrap it to 0 */
 	if (tcp_hdrlen >= 15 * 4)
 		return 0;
 
 	/*
 	 * MSS Option not found ?! add it..
 	 */
