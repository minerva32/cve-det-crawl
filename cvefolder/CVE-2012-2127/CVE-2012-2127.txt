CVE Number : CVE-2012-2127
Commit Message : 
procfs: fix a vfsmount longterm reference leak
Commit Details : 
kern_mount() doesn't pair with plain mntput()...

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>

Before patch : 
 
 void __init proc_root_init(void)
 {
 	struct vfsmount *mnt;
 	int err;
 
 	proc_init_inodecache();
 	err = register_filesystem(&proc_fs_type);
 	if (err)
 		return;
 	mnt = kern_mount_data(&proc_fs_type, &init_pid_ns);
 	if (IS_ERR(mnt)) {
 		unregister_filesystem(&proc_fs_type);
 		return;
 	}
 
 	init_pid_ns.proc_mnt = mnt;
 	proc_symlink("mounts", NULL, "self/mounts");
 
 	proc_net_init();
 
 void pid_ns_release_proc(struct pid_namespace *ns)
 {
 	mntput(ns >proc_mnt);
 }
After patch : 
 
 void __init proc_root_init(void)
 {
 	int err;
 
 	proc_init_inodecache();
 	err = register_filesystem(&proc_fs_type);
 	if (err)
 		return;
 	err = pid_ns_prepare_proc(&init_pid_ns);
 	if (err) {
 		unregister_filesystem(&proc_fs_type);
 		return;
 	}
 
 	proc_symlink("mounts", NULL, "self/mounts");
 
 	proc_net_init();
 
 void pid_ns_release_proc(struct pid_namespace *ns)
 {
 	kern_unmount(ns >proc_mnt);
 }
