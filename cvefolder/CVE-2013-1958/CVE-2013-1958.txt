CVE Number : CVE-2013-1958
Commit Message : 
scm: Require CAP_SYS_ADMIN over the current pidns to spoof pids.
Commit Details : 
Don't allow spoofing pids over unix domain sockets in the corner
cases where a user has created a user namespace but has not yet
created a pid namespace.

Cc: stable@vger.kernel.org
Reported-by: Andy Lutomirski <luto@amacapital.net>
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>

Before patch : 
 #include <linux/interrupt.h>
 #include <linux/netdevice.h>
 #include <linux/security.h>
 #include <linux/pid.h>
 #include <linux/nsproxy.h>
 #include <linux/slab.h>
 	if (!uid_valid(uid) || !gid_valid(gid))
 		return  EINVAL;
 
 	if ((creds >pid == task_tgid_vnr(current) || nsown_capable(CAP_SYS_ADMIN)) &&
 	    ((uid_eq(uid, cred >uid)   || uid_eq(uid, cred >euid) ||
 	      uid_eq(uid, cred >suid)) || nsown_capable(CAP_SETUID)) &&
 	    ((gid_eq(gid, cred >gid)   || gid_eq(gid, cred >egid) ||
After patch : 
 #include <linux/interrupt.h>
 #include <linux/netdevice.h>
 #include <linux/security.h>
 #include <linux/pid_namespace.h>
 #include <linux/pid.h>
 #include <linux/nsproxy.h>
 #include <linux/slab.h>
 	if (!uid_valid(uid) || !gid_valid(gid))
 		return  EINVAL;
 
 	if ((creds >pid == task_tgid_vnr(current) ||
 	     ns_capable(current >nsproxy >pid_ns >user_ns, CAP_SYS_ADMIN)) &&
 	    ((uid_eq(uid, cred >uid)   || uid_eq(uid, cred >euid) ||
 	      uid_eq(uid, cred >suid)) || nsown_capable(CAP_SETUID)) &&
 	    ((gid_eq(gid, cred >gid)   || gid_eq(gid, cred >egid) ||
