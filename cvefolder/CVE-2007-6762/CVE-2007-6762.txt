CVE Number : CVE-2007-6762
Commit Message : 
NetLabel: correct CIPSO tag handling when adding new DOI definitions
Commit Details : 
The current netlbl_cipsov4_add_common() function has two problems which are
fixed with this patch.  The first is an off-by-one bug where it is possibile to
overflow the doi_def->tags array.  The second is a bug where the same
doi_def->tags array was not always fully initialized, which caused sporadic
failures.

Signed-off-by: Paul Moore <paul.moore@hp.com>
Signed-off-by: James Morris <jmorris@namei.org>

Before patch : 
 
 	nla_for_each_nested(nla, info >attrs[NLBL_CIPSOV4_A_TAGLST], nla_rem)
 		if (nla >nla_type == NLBL_CIPSOV4_A_TAG) {
 			if (iter > CIPSO_V4_TAG_MAXCNT)
 				return  EINVAL;
 			doi_def >tags[iter  ] = nla_get_u8(nla);
 		}
 	if (iter < CIPSO_V4_TAG_MAXCNT)
 		doi_def >tags[iter] = CIPSO_V4_TAG_INVALID;
 
 	return 0;
 }
After patch : 
 
 	nla_for_each_nested(nla, info >attrs[NLBL_CIPSOV4_A_TAGLST], nla_rem)
 		if (nla >nla_type == NLBL_CIPSOV4_A_TAG) {
 			if (iter >= CIPSO_V4_TAG_MAXCNT)
 				return  EINVAL;
 			doi_def >tags[iter  ] = nla_get_u8(nla);
 		}
 	while (iter < CIPSO_V4_TAG_MAXCNT)
 		doi_def >tags[iter  ] = CIPSO_V4_TAG_INVALID;
 
 	return 0;
 }
