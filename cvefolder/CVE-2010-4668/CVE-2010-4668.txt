CVE Number : CVE-2010-4668
Commit Message : 
block: check for proper length of iov entries earlier in blk_rq_map_user_iov()
Commit Details : 
commit 9284bcf checks for proper length of iov entries in
blk_rq_map_user_iov(). But if the map is unaligned, kernel
will break out the loop without checking for the proper length.
So we need to check the proper length before the unalign check.

Signed-off-by: Xiaotian Feng <dfeng@redhat.com>
Cc: stable@kernel.org
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>

Before patch : 
 	for (i = 0; i < iov_count; i  ) {
 		unsigned long uaddr = (unsigned long)iov[i].iov_base;
 
 		if (uaddr & queue_dma_alignment(q)) {
 			unaligned = 1;
 			break;
 		}
 		if (!iov[i].iov_len)
 			return  EINVAL;
 	}
 
 	if (unaligned || (q >dma_pad_mask & len) || map_data)
After patch : 
 	for (i = 0; i < iov_count; i  ) {
 		unsigned long uaddr = (unsigned long)iov[i].iov_base;
 
 		if (!iov[i].iov_len)
 			return  EINVAL;
 
 		if (uaddr & queue_dma_alignment(q)) {
 			unaligned = 1;
 			break;
 		}
 	}
 
 	if (unaligned || (q >dma_pad_mask & len) || map_data)
