CVE Number : CVE-2011-1771
Commit Message : 
cifs: check for private_data before trying to put it
Commit Details : 
cifs_close doesn't check that the filp->private_data is non-NULL before
trying to put it. That can cause an oops in certain error conditions
that can occur on open or lookup before the private_data is set.

Reported-by: Ben Greear <greearb@candelatech.com>
CC: Stable <stable@kernel.org>
Signed-off-by: Jeff Layton <jlayton@redhat.com>
Signed-off-by: Steve French <sfrench@us.ibm.com>

Before patch : 
 
 int cifs_close(struct inode *inode, struct file *file)
 {
 	cifsFileInfo_put(file >private_data);
 	file >private_data = NULL;
 
 	/* return code from the  >release op is always ignored */
 	return 0;
After patch : 
 
 int cifs_close(struct inode *inode, struct file *file)
 {
 	if (file >private_data != NULL) {
 		cifsFileInfo_put(file >private_data);
 		file >private_data = NULL;
 	}
 
 	/* return code from the  >release op is always ignored */
 	return 0;
