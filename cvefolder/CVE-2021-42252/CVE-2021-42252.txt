CVE Number : CVE-2021-42252
Commit Message : 
soc: aspeed: lpc-ctrl: Fix boundary check for mmap
Commit Details : 
The check mixes pages (vm_pgoff) with bytes (vm_start, vm_end) on one
side of the comparison, and uses resource address (rather than just the
resource size) on the other side of the comparison.
This can allow malicious userspace to easily bypass the boundary check and
map pages that are located outside memory-region reserved by the driver.

Fixes: 6c4e97678501 ("drivers/misc: Add Aspeed LPC control driver")
Cc: stable@vger.kernel.org
Signed-off-by: Iwona Winiarska <iwona.winiarska@intel.com>
Reviewed-by: Andrew Jeffery <andrew@aj.id.au>
Tested-by: Andrew Jeffery <andrew@aj.id.au>
Reviewed-by: Joel Stanley <joel@aj.id.au>
Signed-off-by: Joel Stanley <joel@jms.id.au>

Before patch : 
 	unsigned long vsize = vma >vm_end   vma >vm_start;
 	pgprot_t prot = vma >vm_page_prot;
 
 	if (vma >vm_pgoff   vsize > lpc_ctrl >mem_base   lpc_ctrl >mem_size)
 		return  EINVAL;
 
 	/* ast2400/2500 AHB accesses are not cache coherent */
After patch : 
 	unsigned long vsize = vma >vm_end   vma >vm_start;
 	pgprot_t prot = vma >vm_page_prot;
 
 	if (vma >vm_pgoff   vma_pages(vma) > lpc_ctrl >mem_size >> PAGE_SHIFT)
 		return  EINVAL;
 
 	/* ast2400/2500 AHB accesses are not cache coherent */
