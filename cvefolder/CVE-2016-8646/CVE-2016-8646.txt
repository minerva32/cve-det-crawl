CVE Number : CVE-2016-8646
Commit Message : 
crypto: algif_hash - Only export and import on sockets with data
Commit Details : 
The hash_accept call fails to work on sockets that have not received
any data.  For some algorithm implementations it may cause crashes.

This patch fixes this by ensuring that we only export and import on
sockets that have received data.

Cc: stable@vger.kernel.org
Reported-by: Harsh Jain <harshjain.prof@gmail.com>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Tested-by: Stephan Mueller <smueller@chronox.de>

Before patch : 
 	struct sock *sk2;
 	struct alg_sock *ask2;
 	struct hash_ctx *ctx2;
 	int err;
 
 	err = crypto_ahash_export(req, state);
 	if (err)
 		return err;
 
 	sk2 = newsock >sk;
 	ask2 = alg_sk(sk2);
 	ctx2 = ask2 >private;
 	ctx2 >more = 1;
 
 	err = crypto_ahash_import(&ctx2 >req, state);
 	if (err) {
After patch : 
 	struct sock *sk2;
 	struct alg_sock *ask2;
 	struct hash_ctx *ctx2;
 	bool more;
 	int err;
 
 	lock_sock(sk);
 	more = ctx >more;
 	err = more ? crypto_ahash_export(req, state) : 0;
 	release_sock(sk);
 
 	if (err)
 		return err;
 
 	sk2 = newsock >sk;
 	ask2 = alg_sk(sk2);
 	ctx2 = ask2 >private;
 	ctx2 >more = more;
 
 	if (!more)
 		return err;
 
 	err = crypto_ahash_import(&ctx2 >req, state);
 	if (err) {
