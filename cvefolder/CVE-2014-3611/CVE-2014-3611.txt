CVE Number : CVE-2014-3611
Commit Message : 
KVM: x86: Improve thread safety in pit
Commit Details : 
There's a race condition in the PIT emulation code in KVM.  In
__kvm_migrate_pit_timer the pit_timer object is accessed without
synchronization.  If the race condition occurs at the wrong time this
can crash the host kernel.

This fixes CVE-2014-3611.

Cc: stable@vger.kernel.org
Signed-off-by: Andrew Honig <ahonig@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Before patch : 
 		return;
 
 	timer = &pit >pit_state.timer;
 	if (hrtimer_cancel(timer))
 		hrtimer_start_expires(timer, HRTIMER_MODE_ABS);
 }
 
 static void destroy_pit_timer(struct kvm_pit *pit)
After patch : 
 		return;
 
 	timer = &pit >pit_state.timer;
 	mutex_lock(&pit >pit_state.lock);
 	if (hrtimer_cancel(timer))
 		hrtimer_start_expires(timer, HRTIMER_MODE_ABS);
 	mutex_unlock(&pit >pit_state.lock);
 }
 
 static void destroy_pit_timer(struct kvm_pit *pit)
