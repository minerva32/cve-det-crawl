CVE Number : CVE-2014-0155
Commit Message : 
KVM: ioapic: fix assignment of ioapic->rtc_status.pending_eoi (CVE-2014-0155)
Commit Details : 
QE reported that they got the BUG_ON in ioapic_service to trigger.
I cannot reproduce it, but there are two reasons why this could happen.

The less likely but also easiest one, is when kvm_irq_delivery_to_apic
does not deliver to any APIC and returns -1.

Because irqe.shorthand == 0, the kvm_for_each_vcpu loop in that
function is never reached.  However, you can target the similar loop in
kvm_irq_delivery_to_apic_fast; just program a zero logical destination
address into the IOAPIC, or an out-of-range physical destination address.

Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Before patch : 
 		BUG_ON(ioapic >rtc_status.pending_eoi != 0);
 		ret = kvm_irq_delivery_to_apic(ioapic >kvm, NULL, &irqe,
 				ioapic >rtc_status.dest_map);
 		ioapic >rtc_status.pending_eoi = ret;
 	} else
 		ret = kvm_irq_delivery_to_apic(ioapic >kvm, NULL, &irqe, NULL);
 
After patch : 
 		BUG_ON(ioapic >rtc_status.pending_eoi != 0);
 		ret = kvm_irq_delivery_to_apic(ioapic >kvm, NULL, &irqe,
 				ioapic >rtc_status.dest_map);
 		ioapic >rtc_status.pending_eoi = (ret < 0 ? 0 : ret);
 	} else
 		ret = kvm_irq_delivery_to_apic(ioapic >kvm, NULL, &irqe, NULL);
 
