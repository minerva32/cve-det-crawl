CVE Number : CVE-2008-3525
Commit Message : 
wan: Missing capability checks in sbni_ioctl()
Commit Details : 
There are missing capability checks in the following code:

1300 static int
1301 sbni_ioctl( struct net_device  *dev,  struct ifreq  *ifr,  int  cmd)
1302 {
...
1319     case  SIOCDEVRESINSTATS :
1320         if( current->euid != 0 )    /* root only */
1321             return  -EPERM;
...
1336     case  SIOCDEVSHWSTATE :
1337         if( current->euid != 0 )    /* root only */
1338             return  -EPERM;
...
1357     case  SIOCDEVENSLAVE :
1358         if( current->euid != 0 )    /* root only */
1359             return  -EPERM;
...
1372     case  SIOCDEVEMANSIPATE :
1373         if( current->euid != 0 )    /* root only */
1374             return  -EPERM;

Here's my proposed fix:

Missing capability checks.

Signed-off-by: Eugene Teo <eugeneteo@kernel.sg>
Signed-off-by: David S. Miller <davem@davemloft.net>

Before patch : 
 		break;
 
 	case  SIOCDEVRESINSTATS :
 		if( current >euid != 0 )	/* root only */
 			return   EPERM;
 		memset( &nl >in_stats, 0, sizeof(struct sbni_in_stats) );
 		break;
 		break;
 
 	case  SIOCDEVSHWSTATE :
 		if( current >euid != 0 )	/* root only */
 			return   EPERM;
 
 		spin_lock( &nl >lock );
 #ifdef CONFIG_SBNI_MULTILINE
 
 	case  SIOCDEVENSLAVE :
 		if( current >euid != 0 )	/* root only */
 			return   EPERM;
 
 		if (copy_from_user( slave_name, ifr >ifr_data, sizeof slave_name ))
 		return  enslave( dev, slave_dev );
 
 	case  SIOCDEVEMANSIPATE :
 		if( current >euid != 0 )	/* root only */
 			return   EPERM;
 
 		return  emancipate( dev );
After patch : 
 		break;
 
 	case  SIOCDEVRESINSTATS :
 		if (!capable(CAP_NET_ADMIN))
 			return   EPERM;
 		memset( &nl >in_stats, 0, sizeof(struct sbni_in_stats) );
 		break;
 		break;
 
 	case  SIOCDEVSHWSTATE :
 		if (!capable(CAP_NET_ADMIN))
 			return   EPERM;
 
 		spin_lock( &nl >lock );
 #ifdef CONFIG_SBNI_MULTILINE
 
 	case  SIOCDEVENSLAVE :
 		if (!capable(CAP_NET_ADMIN))
 			return   EPERM;
 
 		if (copy_from_user( slave_name, ifr >ifr_data, sizeof slave_name ))
 		return  enslave( dev, slave_dev );
 
 	case  SIOCDEVEMANSIPATE :
 		if (!capable(CAP_NET_ADMIN))
 			return   EPERM;
 
 		return  emancipate( dev );
