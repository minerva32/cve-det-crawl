CVE Number : CVE-2010-2226
Commit Message : 
xfs: prevent swapext from operating on write-only files
Commit Details : 
This patch prevents user "foo" from using the SWAPEXT ioctl to swap
a write-only file owned by user "bar" into a file owned by "foo" and
subsequently reading it.  It does so by checking that the file
descriptors passed to the ioctl are also opened for reading.

Signed-off-by: Dan Rosenberg <dan.j.rosenberg@gmail.com>
Reviewed-by: Christoph Hellwig <hch@lst.de>

Before patch : 
 		goto out;
 	}
 
 	if (!(file >f_mode & FMODE_WRITE) || (file >f_flags & O_APPEND)) {
 		error = XFS_ERROR(EBADF);
 		goto out_put_file;
 	}
 	}
 
 	if (!(tmp_file >f_mode & FMODE_WRITE) ||
 	    (tmp_file >f_flags & O_APPEND)) {
 		error = XFS_ERROR(EBADF);
 		goto out_put_tmp_file;
After patch : 
 		goto out;
 	}
 
 	if (!(file >f_mode & FMODE_WRITE) ||
 	    !(file >f_mode & FMODE_READ) ||
 	    (file >f_flags & O_APPEND)) {
 		error = XFS_ERROR(EBADF);
 		goto out_put_file;
 	}
 	}
 
 	if (!(tmp_file >f_mode & FMODE_WRITE) ||
 	    !(tmp_file >f_mode & FMODE_READ) ||
 	    (tmp_file >f_flags & O_APPEND)) {
 		error = XFS_ERROR(EBADF);
 		goto out_put_tmp_file;
