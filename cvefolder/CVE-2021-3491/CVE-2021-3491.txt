CVE Number : CVE-2021-3491
Commit Message : 
io_uring: truncate lengths larger than MAX_RW_COUNT on provide buffers
Commit Details : 
Read and write operations are capped to MAX_RW_COUNT. Some read ops rely on
that limit, and that is not guaranteed by the IORING_OP_PROVIDE_BUFFERS.

Truncate those lengths when doing io_add_buffers, so buffer addresses still
use the uncapped length.

Also, take the chance and change struct io_buffer len member to __u32, so
it matches struct io_provide_buffer len member.

This fixes CVE-2021-3491, also reported as ZDI-CAN-13546.

Fixes: ddf0322db79c ("io_uring: add IORING_OP_PROVIDE_BUFFERS")
Reported-by: Billy Jheng Bing-Jhong (@st424204)
Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>

Before patch : 
 struct io_buffer {
 	struct list_head list;
 	__u64 addr;
 	__s32 len;
 	__u16 bid;
 };
 
 			break;
 
 		buf >addr = addr;
 		buf >len = pbuf >len;
 		buf >bid = bid;
 		addr  = pbuf >len;
 		bid  ;
After patch : 
 struct io_buffer {
 	struct list_head list;
 	__u64 addr;
 	__u32 len;
 	__u16 bid;
 };
 
 			break;
 
 		buf >addr = addr;
 		buf >len = min_t(__u32, pbuf >len, MAX_RW_COUNT);
 		buf >bid = bid;
 		addr  = pbuf >len;
 		bid  ;
