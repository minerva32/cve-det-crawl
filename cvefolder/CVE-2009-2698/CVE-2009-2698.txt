CVE Number : CVE-2009-2698
Commit Message : 
UDP: Fix MSG_PROBE crash
Commit Details : 
UDP tracks corking status through the pending variable.  The
IP layer also tracks it through the socket write queue.  It
is possible for the two to get out of sync when MSG_PROBE is
used.

This patch changes UDP to check the write queue to ensure
that the two stay in sync.

Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: David S. Miller <davem@davemloft.net>

Before patch : 
 		udp_flush_pending_frames(sk);
 	else if (!corkreq)
 		err = udp_push_pending_frames(sk, up);
 	release_sock(sk);
 
 out:
 		udp_v6_flush_pending_frames(sk);
 	else if (!corkreq)
 		err = udp_v6_push_pending_frames(sk, up);
 
 	if (dst) {
 		if (connected) {
After patch : 
 		udp_flush_pending_frames(sk);
 	else if (!corkreq)
 		err = udp_push_pending_frames(sk, up);
 	else if (unlikely(skb_queue_empty(&sk >sk_write_queue)))
 		up >pending = 0;
 	release_sock(sk);
 
 out:
 		udp_v6_flush_pending_frames(sk);
 	else if (!corkreq)
 		err = udp_v6_push_pending_frames(sk, up);
 	else if (unlikely(skb_queue_empty(&sk >sk_write_queue)))
 		up >pending = 0;
 
 	if (dst) {
 		if (connected) {
