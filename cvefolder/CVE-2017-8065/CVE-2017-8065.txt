CVE Number : CVE-2017-8065
Commit Message : 
crypto: ccm - move cbcmac input off the stack
Commit Details : 
Commit f15f05b0a5de ("crypto: ccm - switch to separate cbcmac driver")
refactored the CCM driver to allow separate implementations of the
underlying MAC to be provided by a platform. However, in doing so, it
moved some data from the linear region to the stack, which violates the
SG constraints when the stack is virtually mapped.

So move idata/odata back to the request ctx struct, of which we can
reasonably expect that it has been allocated using kmalloc() et al.

Reported-by: Johannes Berg <johannes@sipsolutions.net>
Fixes: f15f05b0a5de ("crypto: ccm - switch to separate cbcmac driver")
Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Tested-by: Johannes Berg <johannes@sipsolutions.net>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

Before patch : 
 
 struct crypto_ccm_req_priv_ctx {
 	u8 odata[16];
 	u8 auth_tag[16];
 	u32 flags;
 	struct scatterlist src[3];
 	AHASH_REQUEST_ON_STACK(ahreq, ctx >mac);
 	unsigned int assoclen = req >assoclen;
 	struct scatterlist sg[3];
 	u8 odata[16];
 	u8 idata[16];
 	int ilen, err;
 
 	/* format control data for input */
After patch : 
 
 struct crypto_ccm_req_priv_ctx {
 	u8 odata[16];
 	u8 idata[16];
 	u8 auth_tag[16];
 	u32 flags;
 	struct scatterlist src[3];
 	AHASH_REQUEST_ON_STACK(ahreq, ctx >mac);
 	unsigned int assoclen = req >assoclen;
 	struct scatterlist sg[3];
 	u8 *odata = pctx >odata;
 	u8 *idata = pctx >idata;
 	int ilen, err;
 
 	/* format control data for input */
